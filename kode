<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vedmasseberegner</title>
    
    <!-- Henter React og værktøjer direkte fra nettet -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }
    </style>
</head>
<body class="bg-stone-100 text-stone-800 selection:bg-green-200">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- IKONER ---
        const TreePine = ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m17 14 3 3.3a1 1 0 0 1-.7 1.7H4.7a1 1 0 0 1-.7-1.7L7 14h-.3a1 1 0 0 1-.9-1.5l2.9-4H8.7a1 1 0 0 1-.9-1.5l2.9-4c.5-.7 1.6-.7 2.1 0l2.9 4a1 1 0 0 1-.9 1.5H15l2.9 4a1 1 0 0 1-.9 1.5H17Z"/><path d="M12 22v-3"/></svg>;
        const Calculator = ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></svg>;
        const CircleDashed = ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M10.1 2.18a9.93 9.93 0 0 1 3.8 0"/><path d="M17.6 3.71a9.95 9.95 0 0 1 2.69 2.7"/><path d="M21.82 10.1a9.93 9.93 0 0 1 0 3.8"/><path d="M20.29 17.6a9.95 9.95 0 0 1-2.7 2.69"/><path d="M13.9 21.82a9.94 9.94 0 0 1-3.8 0"/><path d="M6.4 20.29a9.95 9.95 0 0 1-2.69-2.7"/><path d="M2.18 13.9a9.93 9.93 0 0 1 0-3.8"/><path d="M3.71 6.4a9.95 9.95 0 0 1 2.7-2.69"/></svg>;
        const Ruler = ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0Z"/><path d="m14.5 12.5 2-2"/><path d="m11.5 9.5 2-2"/><path d="m8.5 6.5 2-2"/><path d="m17.5 15.5 2-2"/></svg>;
        const Leaf = ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z"/><path d="M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12"/></svg>;
        const FileSpreadsheet = ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a1 1 0 0 0 1 1h4"/><path d="M8 13h2"/><path d="M14 13h2"/><path d="M8 17h2"/><path d="M14 17h2"/></svg>;

        // --- DATA ---
        const FORMTAL_GRIDS = {
            'Ask': { diametre: [10, 20, 30, 40, 50], hoejder: [10, 15, 20, 25, 30], data: [[0.6487, 0.5968, 0.5632, 0.5492, 0.5406], [0.6840, 0.6209, 0.5938, 0.5791, 0.5701], [0.7120, 0.6463, 0.6181, 0.6028, 0.5933], [0.7318, 0.6643, 0.6353, 0.6196, 0.6099], [0.7429, 0.6744, 0.6449, 0.6289, 0.6191]] },
            'Bøg': { diametre: [10, 20, 30, 40, 50], hoejder: [10, 15, 20, 25, 30], data: [[0.6859, 0.6111, 0.5631, 0.5284, 0.5017], [0.7273, 0.6480, 0.5970, 0.5603, 0.5320], [0.7745, 0.6901, 0.6358, 0.5967, 0.5665], [0.8203, 0.7309, 0.6734, 0.6320, 0.6000], [0.8640, 0.7698, 0.7093, 0.6657, 0.6320]] },
            'Douglasgran': { diametre: [10, 20, 30, 40, 50], hoejder: [10, 15, 20, 25, 30], data: [[0.5540, 0.5520, 0.5506, 0.5496, 0.5487], [0.4972, 0.4954, 0.4942, 0.4933, 0.4925], [0.4707, 0.4691, 0.4679, 0.4670, 0.4662], [0.4569, 0.4553, 0.4541, 0.4533, 0.4525], [0.4506, 0.4490, 0.4479, 0.4470, 0.4463]] },
            'Eg': { diametre: [10, 20, 30, 40, 50], hoejder: [10, 15, 20, 25, 30], data: [[0.6701, 0.5867, 0.5404, 0.5093, 0.4865], [0.7307, 0.6398, 0.5893, 0.5554, 0.5305], [0.7777, 0.6809, 0.6271, 0.5911, 0.5646], [0.8195, 0.7175, 0.6609, 0.6229, 0.5949], [0.8588, 0.7520, 0.6926, 0.6528, 0.6235]] },
            'Japansk Lærk': { diametre: [10, 20, 30, 40, 50], hoejder: [10, 15, 20, 25, 30], data: [[0.5653, 0.6158, 0.6598, 0.6984, 0.7329], [0.4796, 0.5224, 0.5597, 0.5925, 0.6218], [0.4316, 0.4701, 0.5038, 0.5333, 0.5596], [0.3967, 0.4321, 0.4630, 0.4901, 0.5143], [0.3678, 0.4006, 0.4293, 0.4544, 0.4769]] },
            'Kæmpegran': { diametre: [10, 20, 30, 40, 50], hoejder: [10, 15, 20, 25, 30], data: [[0.5094, 0.5340, 0.5521, 0.5666, 0.5788], [0.4564, 0.4784, 0.4947, 0.5077, 0.5186], [0.4341, 0.4551, 0.4706, 0.4829, 0.4933], [0.4202, 0.4405, 0.4555, 0.4674, 0.4774], [0.4084, 0.4281, 0.4427, 0.4543, 0.4640]] },
            'Nobilis': { diametre: [10, 20, 30, 40, 50], hoejder: [10, 15, 20, 25, 30], data: [[0.5779, 0.6249, 0.6727, 0.7173, 0.7586], [0.5035, 0.5445, 0.5861, 0.6250, 0.6610], [0.4645, 0.5024, 0.5407, 0.5766, 0.6098], [0.4387, 0.4745, 0.5107, 0.5446, 0.5759], [0.4197, 0.4539, 0.4886, 0.5210, 0.5510]] },
            'Rødgran': { diametre: [10, 20, 30, 40, 50], hoejder: [10, 15, 20, 25, 30], data: [[0.5801, 0.5978, 0.6142, 0.6286, 0.6414], [0.5166, 0.5323, 0.5470, 0.5598, 0.5712], [0.4800, 0.4946, 0.5082, 0.5202, 0.5308], [0.4479, 0.4615, 0.4742, 0.4854, 0.4952], [0.4147, 0.4274, 0.4391, 0.4494, 0.4586]] },
            'Sitkagran': { diametre: [10, 20, 30, 40, 50], hoejder: [10, 15, 20, 25, 30], data: [[0.5407, 0.5892, 0.6397, 0.6876, 0.7324], [0.4582, 0.4994, 0.5422, 0.5828, 0.6207], [0.4095, 0.4462, 0.4845, 0.5207, 0.5547], [0.3703, 0.4036, 0.4381, 0.4709, 0.5016], [0.3347, 0.3647, 0.3960, 0.4256, 0.4533]] },
            'Thuja': { diametre: [10, 20, 30, 40, 50], hoejder: [10, 15, 20, 25, 30], data: [[0.4958, 0.6283, 0.7433, 0.8468, 0.9420], [0.3454, 0.4378, 0.5179, 0.5900, 0.6563], [0.2703, 0.3426, 0.4053, 0.4617, 0.5137], [0.2272, 0.2879, 0.3406, 0.3880, 0.4317], [0.1985, 0.2516, 0.2976, 0.3391, 0.3772]] },
            'Ædelgran': { diametre: [10, 20, 30, 40, 50], hoejder: [10, 15, 20, 25, 30], data: [[0.5752, 0.5644, 0.5834, 0.6097, 0.6380], [0.5381, 0.5279, 0.5457, 0.5704, 0.5968], [0.5080, 0.4984, 0.5152, 0.5384, 0.5634], [0.4669, 0.4581, 0.4736, 0.4950, 0.5179], [0.4133, 0.4055, 0.4192, 0.4381, 0.4584]] },
        };

        const TRAEARTER = [
            { navn: 'Ask', standardFormtal: 0.59, metode: 'avanceret' },
            { navn: 'Bøg', standardFormtal: 0.58, metode: 'avanceret' }, 
            { navn: 'Douglasgran', standardFormtal: 0.50, metode: 'avanceret' },
            { navn: 'Eg', standardFormtal: 0.62, metode: 'avanceret' },
            { navn: 'Japansk Lærk', standardFormtal: 0.46, metode: 'avanceret' }, 
            { navn: 'Kæmpegran', standardFormtal: 0.48, metode: 'avanceret' },
            { navn: 'Nobilis', standardFormtal: 0.50, metode: 'avanceret' },
            { navn: 'Rødgran', standardFormtal: 0.52, metode: 'avanceret' }, 
            { navn: 'Sitkagran', standardFormtal: 0.48, metode: 'avanceret' },
            { navn: 'Thuja', standardFormtal: 0.50, metode: 'avanceret' }, 
            { navn: 'Ædelgran', standardFormtal: 0.54, metode: 'avanceret' }, 
        ];

        function SkovBeregner() {
            const [radius, setRadius] = useState(''); 
            const [antalTræerIPrøve, setAntalTræerIPrøve] = useState(''); 

            const [diameter, setDiameter] = useState(''); 
            const [højde, setHøjde] = useState(''); 
            
            const [valgtTræIndeks, setValgtTræIndeks] = useState(0);
            const [areal, setAreal] = useState(''); 

            const [resultater, setResultater] = useState({
                stamtalPrHa: 0,
                grundfladeEnkelt: 0,
                grundfladeTotal: 0,
                volumenEnkelt: 0,
                volumenHa: 0,
                volumenTotal: 0
            });

            // Beregningsmotor
            const beregnFormtalFraGrid = (d, h, gridData) => {
                const clamp = (val, min, max) => Math.min(Math.max(val, min), max);
                const minD = gridData.diametre[0];
                const maxD = gridData.diametre[gridData.diametre.length - 1];
                const minH = gridData.hoejder[0];
                const maxH = gridData.hoejder[gridData.hoejder.length - 1];

                const d_safe = clamp(d, minD, maxD);
                const h_safe = clamp(h, minH, maxH);

                let i = 0; while (i < gridData.diametre.length - 2 && d_safe > gridData.diametre[i+1]) i++;
                let j = 0; while (j < gridData.hoejder.length - 2 && h_safe > gridData.hoejder[j+1]) j++;

                const x1 = gridData.diametre[i], x2 = gridData.diametre[i+1];
                const y1 = gridData.hoejder[j], y2 = gridData.hoejder[j+1];
                const Q11 = gridData.data[i][j], Q12 = gridData.data[i][j+1];
                const Q21 = gridData.data[i+1][j], Q22 = gridData.data[i+1][j+1];

                const x_factor = (d_safe - x1) / (x2 - x1);
                const y_factor = (h_safe - y1) / (y2 - y1);

                const R1 = Q11 + x_factor * (Q21 - Q11);
                const R2 = Q12 + x_factor * (Q22 - Q12);
                return R1 + y_factor * (R2 - R1);
            };

            const hentAktueltFormtal = () => {
                const art = TRAEARTER[valgtTræIndeks];
                const grid = FORMTAL_GRIDS[art.navn];
                const dVal = parseFloat(diameter) || 0;
                const hVal = parseFloat(højde) || 0;
                if (grid) {
                    const f = beregnFormtalFraGrid(dVal, hVal, grid);
                    return { værdi: f, kilde: 'Smart-Model (D/H)' };
                }
                return { værdi: 0.5, kilde: 'Standard' };
            };

            const formtalData = hentAktueltFormtal();
            const formtal = formtalData.værdi;

            useEffect(() => {
                const rVal = parseFloat(radius) || 0;
                const antalVal = parseFloat(antalTræerIPrøve) || 0;
                const dVal = parseFloat(diameter) || 0;
                const hVal = parseFloat(højde) || 0;
                const aVal = parseFloat(areal) || 0;

                const prøveArealM2 = Math.PI * Math.pow(rVal, 2);
                const opgangningsFaktor = prøveArealM2 > 0 ? 10000 / prøveArealM2 : 0;
                const beregnetStamtal = antalVal * opgangningsFaktor;

                const radiusM = (dVal / 100) / 2;
                const g = Math.PI * Math.pow(radiusM, 2);

                const G = g * beregnetStamtal;
                const v = g * hVal * formtal;
                const V_ha = v * beregnetStamtal;
                const V_total = V_ha * aVal;

                setResultater({ stamtalPrHa: beregnetStamtal, grundfladeEnkelt: g, grundfladeTotal: G, volumenEnkelt: v, volumenHa: V_ha, volumenTotal: V_total });
            }, [diameter, højde, radius, antalTræerIPrøve, formtal, areal]);

            const handleInputChange = (setter) => (e) => {
                const val = e.target.value;
                if (val === '' || /^[0-9]*\.?[0-9]*$/.test(val)) setter(val);
            };

            return (
                <div className="min-h-screen p-4 md:p-8 flex justify-center">
                    <div className="w-full max-w-3xl bg-white rounded-xl shadow-xl overflow-hidden border border-stone-200">
                        {/* Header */}
                        <div className="bg-green-800 p-6 text-white flex items-center justify-between">
                            <div>
                                <h1 className="text-2xl font-bold flex items-center gap-2">
                                    <TreePine className="w-8 h-8" />
                                    Vedmasseberegner
                                </h1>
                            </div>
                            <Calculator className="w-8 h-8 opacity-50" />
                        </div>

                        <div className="p-6 grid gap-8">
                            {/* INPUT SEKTION */}
                            <div className="space-y-4">
                                <h2 className="text-lg font-semibold border-b pb-2 border-stone-200 flex items-center gap-2 text-green-900">
                                    <CircleDashed className="w-5 h-5" />
                                    Prøveflade
                                </h2>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6 bg-green-50 p-4 rounded-lg border border-green-100">
                                    <div className="flex flex-col">
                                        <label className="text-xs font-bold uppercase text-green-800 mb-1">Prøveflade Radius (m)</label>
                                        <input type="text" inputMode="decimal" value={radius} onChange={handleInputChange(setRadius)} className="p-3 border rounded-lg focus:ring-2 focus:ring-green-500 outline-none bg-white shadow-sm" placeholder="F.eks. 10" />
                                    </div>
                                    <div className="flex flex-col">
                                        <label className="text-xs font-bold uppercase text-green-800 mb-1">Antal træer i cirklen</label>
                                        <input type="text" inputMode="numeric" value={antalTræerIPrøve} onChange={handleInputChange(setAntalTræerIPrøve)} className="p-3 border rounded-lg focus:ring-2 focus:ring-green-500 outline-none bg-white shadow-sm" placeholder="Tæl træerne..." />
                                        <p className="text-xs text-green-600 mt-1 text-right">Stamtal: <span className="font-bold">{Math.round(resultater.stamtalPrHa)}</span> stk/ha</p>
                                    </div>
                                    <div className="flex flex-col md:col-span-2">
                                        <label className="text-sm font-medium text-stone-600 mb-1">Træart</label>
                                        <div className="relative">
                                            <select value={valgtTræIndeks} onChange={(e) => setValgtTræIndeks(Number(e.target.value))} className="w-full p-3 border rounded-lg bg-white cursor-pointer appearance-none focus:ring-2 focus:ring-green-500 outline-none">
                                                {TRAEARTER.map((træ, index) => <option key={index} value={index}>{træ.navn}</option>)}
                                            </select>
                                            <div className="absolute inset-y-0 right-0 flex items-center px-3 pointer-events-none text-stone-500">
                                                <svg className="w-4 h-4 fill-current" viewBox="0 0 20 20"><path d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clipRule="evenodd" fillRule="evenodd"></path></svg>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div className="space-y-4">
                                <h2 className="text-lg font-semibold border-b pb-2 border-stone-200 flex items-center gap-2">
                                    <Ruler className="w-5 h-5 text-stone-600" />
                                    Målinger
                                </h2>
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                    <div className="flex flex-col">
                                        <label className="text-sm font-medium text-stone-600 mb-1 h-10 flex items-end pb-1">Diameter v. 1,3 m (cm)</label>
                                        <input type="text" inputMode="decimal" value={diameter} onChange={handleInputChange(setDiameter)} className="p-3 border rounded-lg bg-stone-50 focus:ring-2 focus:ring-green-500 outline-none transition-all" placeholder="Gennemsnit" />
                                    </div>
                                    <div className="flex flex-col">
                                        <label className="text-sm font-medium text-stone-600 mb-1 h-10 flex items-end pb-1">Træhøjde (m)</label>
                                        <input type="text" inputMode="decimal" value={højde} onChange={handleInputChange(setHøjde)} className="p-3 border rounded-lg bg-stone-50 focus:ring-2 focus:ring-green-500 outline-none transition-all" placeholder="Gennemsnit" />
                                    </div>
                                    <div className="flex flex-col">
                                        <label className="text-sm font-medium text-stone-600 mb-1 h-10 flex items-end pb-1">Areal (ha)</label>
                                        <input type="text" inputMode="decimal" value={areal} onChange={handleInputChange(setAreal)} className="p-3 border rounded-lg bg-stone-50 focus:ring-2 focus:ring-green-500 outline-none transition-all" placeholder="Total" />
                                    </div>
                                </div>
                            </div>

                            {/* RESULTAT SEKTION */}
                            <div className="bg-stone-800 text-stone-100 rounded-xl p-6 border border-stone-600 shadow-xl">
                                <h2 className="text-lg font-semibold mb-6 flex items-center gap-2 text-green-400">
                                    <Leaf className="w-5 h-5" />
                                    Beregnet vedmasse
                                </h2>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                                    <div className="space-y-3 text-sm">
                                        <div className="flex justify-between border-b border-stone-600 pb-1">
                                            <span className="text-stone-400 flex items-center gap-2">
                                                Formtal ({TRAEARTER[valgtTræIndeks].navn}):
                                            </span>
                                            <span className="font-mono text-yellow-400">{formtal.toFixed(4)}</span>
                                        </div>
                                        <div className="flex justify-between border-b border-stone-600 pb-1">
                                            <span className="text-stone-400">Middelstammens grundflade (g):</span>
                                            <span>{resultater.grundfladeEnkelt.toFixed(4)} m²</span>
                                        </div>
                                        <div className="flex justify-between border-b border-stone-600 pb-1">
                                            <span className="text-stone-400">Middelstammens volumen (v):</span>
                                            <span>{resultater.volumenEnkelt.toFixed(3)} m³</span>
                                        </div>
                                        <div className="flex justify-between border-b border-stone-600 pb-1">
                                            <span className="text-stone-400">Grundflade pr. ha (G):</span>
                                            <span className="text-green-300 font-bold">{resultater.grundfladeTotal.toFixed(2)} m²/ha</span>
                                        </div>
                                    </div>
                                    <div className="flex flex-col gap-4 justify-center bg-stone-700/50 p-4 rounded-lg">
                                        <div className="text-center">
                                            <p className="text-stone-400 text-xs uppercase tracking-wide">Volumen pr. Hektar</p>
                                            <p className="text-3xl font-bold text-white">{resultater.volumenHa.toFixed(1)} m³</p>
                                        </div>
                                        <div className="h-px bg-stone-600 w-full"></div>
                                        <div className="text-center">
                                            <p className="text-stone-400 text-xs uppercase tracking-wide">Total for {areal || 0} ha</p>
                                            <p className="text-4xl font-bold text-green-400">{resultater.volumenTotal.toFixed(1)} m³</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<SkovBeregner />);
    </script>
</body>
</html>
